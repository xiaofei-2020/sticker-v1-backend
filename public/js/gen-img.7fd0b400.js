(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([["gen-img"],{a0d1:function(t,e,n){"use strict";n("c8d6")},aa99:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"gen-img"},[n("div",{staticClass:"gen-img-content"},[t._m(0),n("canvas",{attrs:{id:"gen-img-canvas"}}),n("div",{staticClass:"tool-box"},[n("div",{staticClass:"sel-img-box"},[n("el-upload",{ref:"selImgUpload",attrs:{action:"","auto-upload":!1,"show-file-list":!1,accept:".png,.jpg,.webp","on-change":t.handleUploadChange,limit:1}},[n("el-button",{attrs:{type:"text"}},[n("i",{staticClass:"el-icon-circle-plus-outline"}),t._v(t._s(t.hasChosenImg?"重新选择":"选择本地图片"))])],1),n("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasChosenImg,expression:"hasChosenImg"}],staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:t.cancelSel}},[n("i",{staticClass:"el-icon-circle-close"}),t._v("取消选择")])],1),n("div",{staticClass:"tool-box-detail"},[n("span",{staticStyle:{"margin-bottom":"6px"}},[t._v("表情文本内容：")]),n("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:"请输入要添加的文字"},model:{value:t.inputText,callback:function(e){t.inputText=e},expression:"inputText"}}),n("div",{staticStyle:{"text-align":"center",margin:"16px auto"}},[n("span",{staticClass:"mr-8"},[t._v("字体颜色：")]),n("el-color-picker",{staticClass:"mr-16",attrs:{size:"mini"},model:{value:t.fontStyleForm.color,callback:function(e){t.$set(t.fontStyleForm,"color",e)},expression:"fontStyleForm.color"}}),n("span",{staticClass:"mr-8"},[t._v("字体大小：")]),n("el-input-number",{staticClass:"mr-16",attrs:{min:10,max:60,label:"描述文字",size:"mini"},model:{value:t.fontStyleForm.fontSize,callback:function(e){t.$set(t.fontStyleForm,"fontSize",e)},expression:"fontStyleForm.fontSize"}})],1),n("div",{staticClass:"btn"},[n("el-button",{attrs:{type:"primary"},on:{click:t.handleGenImg}},[t._v("生成")]),n("el-button",{attrs:{type:"primary"},on:{click:t.download}},[t._v("下载")])],1)],1)])])])},c=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h2",[n("i",{staticClass:"el-icon-edit-outline"}),t._v(" 表情制作")])}],r=n("1da1"),a=(n("96cf"),n("c740"),n("d3b7"),n("365c")),s={name:"GenImg",components:{},data:function(){return{ctx:null,ctxWidth:300,ctxHeight:300,inputText:"",defaultImgSrc:"",currentImgSrc:"",curImg:null,hasChosenImg:!1,textRowHeight:50,resource_id:"",hasCollect:!1,fontStyleForm:{fontSize:48,color:"#fff"}}},mounted:function(){this.init()},methods:{init:function(){this.initCanvas(),this.initDefImg()},getUsrCollections:function(){var t=this,e={page:1,pageSize:1e3};Object(a["a"])("get",null,e).then((function(e){if(!0===e.success){var n=e.data.elements.findIndex((function(e){return e.resource_id===t.resource_id}));t.hasCollect=n>-1}}))},updateCanvasSize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=document.getElementById("gen-img-canvas");n.setAttribute("width",t),n.setAttribute("height",e)},initDefImg:function(){var t=this;this.resource_id=this.$route.params.resource_id,Object(a["d"])(this.resource_id).then(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:!0===n.data.success&&(t.defaultImgSrc=t.currentImgSrc=n.data.data.img,t.drawImgFromSrc(t.currentImgSrc));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},initCanvas:function(){var t=document.getElementById("gen-img-canvas");this.updateCanvasSize(),this.ctx=t.getContext("2d")},cancelSel:function(){this.hasChosenImg=!1,this.ctx.clearRect(0,0,this.ctxWidth,this.ctxHeight),this.defaultImgSrc&&this.drawImgFromSrc(this.defaultImgSrc)},handleUploadChange:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.hasChosenImg=!0,n.next=3,e.genBase64(t.raw);case 3:e.currentImgSrc=n.sent,e.drawImgFromSrc(e.currentImgSrc);case 5:case"end":return n.stop()}}),n)})))()},drawImgFromSrc:function(t){var e=arguments,n=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var c,r,a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(c=e.length>1&&void 0!==e[1]?e[1]:300,t&&"string"===typeof t){i.next=3;break}return i.abrupt("return");case 3:return i.next=5,n.genImgEl(t);case 5:n.curImg=i.sent,r=n.curImg.width,a=n.curImg.height,s=r/a,n.ctxWidth=c*s,n.updateCanvasSize(n.ctxWidth,n.ctxHeight),n.ctx.clearRect(0,0,n.ctxWidth,n.ctxHeight),n.drawImg(n.curImg,n.ctxWidth,n.ctxHeight),n.$refs.selImgUpload.clearFiles();case 14:case"end":return i.stop()}}),i)})))()},genImgEl:function(t){return new Promise((function(e){var n=new Image;n.onload=function(){e(n)},n.setAttribute("crossOrigin","anonymous"),n.src=t}))},drawImg:function(t,e,n){this.ctx.drawImage(t,0,0,e,n)},drawText:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.fontSize,i=void 0===n?30:n,c=e.color,r=void 0===c?"#000":c;this.ctx.font="".concat(i,"px serif"),this.ctx.fillStyle=r,this.ctx.strokeStyle="#000",this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.lineWidth="0.5",this.ctx.fillText(t,this.ctxWidth/2,this.ctxHeight-8,this.ctxWidth),this.ctx.strokeText(t,this.ctxWidth/2,this.ctxHeight-8,this.ctxWidth)},genBase64:function(t){return new Promise((function(e){var n=new FileReader;n.onload=function(t){var n=t.target.result;e(n)},n.readAsDataURL(t)}))},handleGenImg:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.curImg){e.next=3;break}return t.$message.error("请选择一张图片"),e.abrupt("return");case 3:t.ctx.clearRect(0,0,t.ctxWidth,t.ctxHeight),t.drawImg(t.curImg,t.ctxWidth,t.ctxHeight),t.drawText(t.inputText,t.fontStyleForm);case 6:case"end":return e.stop()}}),e)})))()},download:function(){var t=document.createElement("a");t.href=document.getElementById("gen-img-canvas").toDataURL(),t.download="test",t.click()},collect:function(){var t=this;Object(a["a"])("post",{resource_id:this.resource_id}).then((function(e){!0===e.success&&(t.$message.success("收藏成功"),t.hasCollect=!0)}))},cancelCollect:function(){var t=this;Object(a["a"])("delete",{resource_id:this.resource_id}).then((function(e){!0===e.success&&(t.$message.success("取消收藏成功"),t.hasCollect=!1)}))}}},o=s,l=(n("a0d1"),n("2877")),u=Object(l["a"])(o,i,c,!1,null,"7f74a32b",null);e["default"]=u.exports},c8d6:function(t,e,n){}}]);